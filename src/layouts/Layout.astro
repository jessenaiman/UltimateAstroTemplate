---
import { ClientRouter } from "astro:transitions";
import Analytics from "@vercel/analytics/astro";
import Background from "../components/ui/Background.astro";
import Footer from "../components/ui/Footer.astro";
import Header from "../components/ui/Header";
import Head from "../components/core/Head.astro";
import { Theme } from '@radix-ui/themes';
import "../styles/global.css";

interface Props {
  title: string;
  bgColor?: string;
  primaryBallColor?: string;
  secondaryBallColor?: string;
  gridColor?: string;
  diagonalColor?: string;
  vignetteColor?: string;
}

const {
  title,
  bgColor = "#0F1115",
  primaryBallColor,
  secondaryBallColor,
  gridColor,
  diagonalColor,
  vignetteColor,
} = Astro.props;

const theme = Astro.cookies.get('theme')?.value || 'dark';
---

<!doctype html>
<html lang="en" class="scroll-smooth">
  <Head title={title} bgColor={bgColor} />
  <body>
    <Theme appearance={theme}>
      <ClientRouter />
      <Analytics />
      <Background
        bgColor={bgColor}
        primaryBallColor={primaryBallColor}
        secondaryBallColor={secondaryBallColor}
        gridColor={gridColor}
        diagonalColor={diagonalColor}
        vignetteColor={vignetteColor}
      />
      <Header client:load />
      <main class="page-content">
        <slot />
      </main>
      <Footer />
    </Theme>

    <script>
      function handleThemeChange() {
        const theme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', theme);
        document.cookie = `theme=${theme};path=/;max-age=31536000`;
      }

      // Initial setup
      handleThemeChange();

      // Listen for theme changes
      window.addEventListener('themeChange', () => {
        handleThemeChange();
      });

      // Handle theme persistence during page transitions
      document.addEventListener('astro:after-swap', () => {
        handleThemeChange();
      });
    </script>
  </body>
</html>

<style is:global>
  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes slide-from-right {
    from { transform: translateX(30px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  @keyframes slide-from-top {
    from { transform: translateY(-30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  ::view-transition-old(root) {
    animation: fade-out 0.5s ease-out both;
  }
  
  ::view-transition-new(root) {
    animation: fade-in 0.5s ease-out both;
  }
  
  .page-content {
    animation: slide-from-right 0.5s ease-out;
  }
  
  .header-content {
    animation: slide-from-top 0.5s ease-out;
  }

  /* Radix UI Theme Overrides */
  .radix-themes {
    --default-font-family: 'Inter', system-ui, -apple-system, sans-serif;
  }

  /* Base theme colors */
  :root {
    --background: #ffffff;
    --foreground: #27272a;
    --muted: #f4f4f5;
    --muted-foreground: #71717a;
    --accent: #2563eb;
  }

  [data-theme='dark'] {
    --background: #0F1115;
    --foreground: #ffffff;
    --muted: #27272a;
    --muted-foreground: #a1a1aa;
    --accent: #3b82f6;
  }

  body {
    background-color: var(--background);
    color: var(--foreground);
  }
</style>
